
<!-- Snippet: Aula TV M5 - Tarot Terapeutico -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<style> 
    .idemab-font-title { font-family: 'Outfit', sans-serif; }
    .idemab-font-body { font-family: 'Inter', sans-serif; }
    .glass-card {
        background: white;
        border: 1px solid rgba(229, 231, 235, 0.5);
    }
</style>

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Header -->
    <div class="mb-12 border-l-4 border-purple-600 pl-6">
        <h2 class="text-4xl font-bold text-gray-900 idemab-font-title tracking-tight mb-2">Módulo 5</h2>
        <p class="text-lg text-gray-500 idemab-font-body">Diplomado en Tarot Terapéutico</p>
    </div>

    <!-- Skeleton Loader -->
    <div id="loading-aula-M5" class="space-y-8">
        <!-- 2 Skeletons -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="aspect-video bg-gray-100 animate-pulse"></div>
            <div class="p-6 space-y-3">
                <div class="h-6 bg-gray-100 rounded w-1/3 animate-pulse"></div>
                <div class="h-4 bg-gray-100 rounded w-3/4 animate-pulse"></div>
            </div>
        </div>
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div class="aspect-video bg-gray-100 animate-pulse"></div>
            <div class="p-6 space-y-3">
                <div class="h-6 bg-gray-100 rounded w-1/3 animate-pulse"></div>
                <div class="h-4 bg-gray-100 rounded w-3/4 animate-pulse"></div>
            </div>
        </div>
    </div>

    <!-- Content Stack -->
    <div id="aula-grid-M5" class="flex flex-col gap-12 hidden opacity-0 transition-opacity duration-700">
        <!-- Cards injected here -->
    </div>
    
    <div id="error-msg-M5" class="hidden text-center bg-red-50 text-red-600 p-4 rounded-lg mt-4"></div>
</div>

<script>
    (function() {
        const API_URL = 'https://script.google.com/macros/s/AKfycbzrHUZHc1yW5sG_pBQtLRim6i5KetHAImyWY6Vga1ib80EyNkKNo87JSHn1B332cHogSQ/exec';
        const TAB_PREFIX = 'Aula TV M5';
        const GRID_ID = 'aula-grid-M5';
        const LOAD_ID = 'loading-aula-M5';
        const ERR_ID = 'error-msg-M5';

        function getEmbedUrl(link) {
            if (!link) return null;
            if (link.includes('youtube.com') || link.includes('youtu.be')) {
                let vid = '';
                try {
                    vid = link.includes('v=') ? link.split('v=')[1].split('&')[0] : link.split('/').pop();
                    return `https://www.youtube.com/embed/${vid}`;
                } catch(e) { return null; }
            }
            if (link.includes('vimeo.com')) {
                try {
                    const vid = link.split('/').pop().split('?')[0];
                    return `https://player.vimeo.com/video/${vid}`;
                } catch(e) { return null; }
            }
            return null;
        }

        async function load() {
            const grid = document.getElementById(GRID_ID);
            const loader = document.getElementById(LOAD_ID);
            const errorDiv = document.getElementById(ERR_ID);

            try {
                const res = await fetch(API_URL);
                const allData = await res.json();
                const exactKey = Object.keys(allData).find(k => k.trim().startsWith(TAB_PREFIX));
                const items = exactKey ? allData[exactKey] : [];
                
                if (items.length === 0) {
                    grid.innerHTML = `
                        <div class="text-center py-16 bg-gray-50 rounded-3xl border border-dashed border-gray-200">
                            <p class="text-gray-400 idemab-font-body">No hay lecciones disponibles.</p>
                        </div>`;
                } else {
                    grid.innerHTML = items.map((item, index) => {
                        if (item.status && String(item.status).toLowerCase().includes('inactivo')) return '';
                        
                        const embedUrl = getEmbedUrl(item.link);
                        let mediaContent = '';

                        if (embedUrl) {
                            mediaContent = `
                                <div class="relative w-full aspect-video bg-black shadow-inner">
                                    <iframe src="${embedUrl}" class="absolute inset-0 w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                </div>
                            `;
                        } else {
                            mediaContent = `
                                <div class="h-64 bg-gray-900 flex flex-col items-center justify-center text-gray-500">
                                    <svg class="w-16 h-16 mb-2 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                    <span class="text-sm font-medium">Video no disponible</span>
                                </div>
                            `;
                        }

                        return `
                        <article class="bg-white rounded-3xl shadow-xl shadow-gray-100 overflow-hidden border border-gray-100 flex flex-col">
                            <!-- Video Section -->
                            ${mediaContent}
                            
                            <!-- Info Section -->
                            <div class="p-8">
                                <div class="flex items-center gap-3 mb-4">
                                    <span class="flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-700 text-sm font-bold idemab-font-title">
                                        ${index + 1}
                                    </span>
                                    <h3 class="text-2xl font-bold text-gray-900 idemab-font-title leading-tight">${item.titulo}</h3>
                                </div>
                                <div class="pl-11">
                                    <p class="text-gray-600 idemab-font-body leading-relaxed text-lg">${item.descripcion || 'Sin descripción.'}</p>
                                    <div class="pt-4 mt-6 border-t border-gray-100 flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                                            <span class="text-xs font-medium text-gray-500 uppercase tracking-wide">Video Player</span>
                                        </div>
                                        <span class="text-xs font-bold text-gray-400 bg-gray-50 px-2 py-1 rounded">Aula TV</span>
                                    </div>
                                </div>
                            </div>
                        </article>`;
                    }).join('');
                }
                
                grid.classList.remove('hidden');
                setTimeout(() => { grid.classList.remove('opacity-0'); }, 100);

            } catch (e) {
                errorDiv.innerHTML = `<p class="text-red-500 font-medium">Error: ${e.message}</p>`;
                errorDiv.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', load);
    })();
</script>
