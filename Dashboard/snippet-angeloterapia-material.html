<!-- Snippet: Material - Angeloterapia (WordPress Ready) -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    .idemab-material {
        font-family: 'Inter', sans-serif;
    }
</style>

<div class="idemab-material max-w-7xl mx-auto p-4">
    <div class="text-center mb-10">
        <h2 class="text-3xl font-bold text-gray-800 tracking-tight">Material de Estudio</h2>
        <p class="text-gray-500 mt-2">Documentos y recursos descargables.</p>

        <!-- Module Selector -->
        <div class="mt-4 flex justify-center gap-2">
            <button onclick="loadMaterial('M1')"
                class="px-4 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-700 hover:bg-blue-200 transition-colors">Módulo
                1</button>
            <button onclick="loadMaterial('M2')"
                class="px-4 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors">Módulo
                2</button>
            <button onclick="loadMaterial('M3')"
                class="px-4 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors">Módulo
                3</button>
            <button onclick="loadMaterial('M4')"
                class="px-4 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600 hover:bg-gray-200 transition-colors">Módulo
                4</button>
        </div>
    </div>

    <div id="loading-material" class="text-center py-10">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto"></div>
        <p class="text-gray-400 text-sm mt-3">Cargando material...</p>
    </div>

    <div id="material-list" class="grid grid-cols-1 gap-4 hidden max-w-4xl mx-auto">
        <!-- List Items injected here -->
    </div>

    <div id="error-msg-material" class="hidden text-center text-red-500 py-4"></div>
</div>

<script>
    // AGREGA AQUI TU URL DEL DEPLOY
    const API_URL_ANGEL_MAT = 'URL_DEL_DEPLOY_APPS_SCRIPT';

    async function loadMaterial(module = 'M1') {
        const list = document.getElementById('material-list');
        const loader = document.getElementById('loading-material');
        const errorDiv = document.getElementById('error-msg-material');

        list.innerHTML = '';
        list.classList.add('hidden');
        errorDiv.classList.add('hidden');
        loader.classList.remove('hidden');

        try {
            const res = await fetch(`${API_URL_ANGEL_MAT}?action=getMaterial&module=${module}`);
            const json = await res.json();

            if (json.status === 'success') {
                if (json.data.length === 0) {
                    list.innerHTML = '<p class="text-center text-gray-400">No hay materiales en este módulo.</p>';
                } else {
                    list.innerHTML = json.data.map(item => {
                        if (item.status && String(item.status).toLowerCase().includes('inactivo')) return '';

                        let icon = '<svg class="w-6 h-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>';
                        if (item.formato && item.formato.toLowerCase().includes('pdf')) {
                            icon = '<svg class="w-6 h-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>';
                        }

                        return `
                        <div class="bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row items-start md:items-center justify-between gap-4 hover:bg-gray-50 transition-colors">
                            <div class="flex items-start gap-4">
                                <div class="mt-1">${icon}</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">${item.titulo}</h3>
                                    <p class="text-sm text-gray-500">${item.descripcion || ''}</p>
                                </div>
                            </div>
                            <a href="${item.link}" target="_blank" class="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 hover:text-blue-600 transition-colors whitespace-nowrap">
                                Descargar
                            </a>
                        </div>`;
                    }).join('');
                }
                list.classList.remove('hidden');
            } else {
                throw new Error(json.message);
            }
        } catch (e) {
            errorDiv.innerHTML = `Error: ${e.message}`;
            errorDiv.classList.remove('hidden');
        } finally {
            loader.classList.add('hidden');
        }
    }

    document.addEventListener('DOMContentLoaded', () => loadMaterial('M1'));
</script>